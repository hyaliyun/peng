import{_ as v,c as a,o as l,j as o,e as u,a as m,am as c,an as h,t as d,ao as C,Z as P,a0 as g,F as y,B as w,G as k}from"./chunks/framework.CvQVt9Yw.js";function b(i,e){let s;return function(...f){clearTimeout(s),s=setTimeout(()=>i.apply(this,f),e)}}function V(i=4){const e="0123456789";return Array.from({length:i},()=>e[Math.floor(Math.random()*e.length)]).join("")}function I(i){return/^1[3-9]\d{9}$/.test(i)}function N(i){if(!/^\d{17}[\dXx]$/.test(i))return!1;const s=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],f=["1","0","X","9","8","7","6","5","4","3","2"],t=i.substring(0,17).split("").reduce((n,r,p)=>n+parseInt(r)*s[p],0);return f[t%11]===i[17].toUpperCase()}const S={data(){return{form:{name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},generatedVerificationCode:"",submitted:!1,lastSubmittedForm:{},records:[],isAdmin:!1,currentPage:1,totalPages:1,pageSize:5,errors:{},loading:!1}},mounted(){this.generateVerificationCode(),this.isAdmin&&this.loadRecords()},methods:{generateVerificationCode(){this.generatedVerificationCode=V(),this.errors.verificationCode=""},validatePhoneInput:b(function(){this.form.contact&&!I(this.form.contact)?this.errors.contact="手机号格式不正确":this.errors.contact=""},300),validateIDInput:b(function(){this.form.idNumber&&!N(this.form.idNumber)?this.errors.idNumber="身份证号格式不正确":this.errors.idNumber=""},300),validateNameInput(){this.form.name&&this.form.name.length<2?this.errors.name="姓名至少需要2个字符":this.errors.name=""},async loadRecords(i=1){try{const e=await fetch(`/records?page=${i}&pageSize=${this.pageSize}`);if(!e.ok)throw new Error("加载失败");const s=await e.json();this.records=s.records,this.currentPage=s.currentPage,this.totalPages=s.totalPages}catch(e){console.error("加载记录失败:",e),alert("加载记录失败，请稍后重试")}},async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const i=await fetch("/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(!i.ok){const s=await i.text();throw new Error(s||"提交失败")}const e=await i.json();this.lastSubmittedForm=e,this.submitted=!0,this.resetForm(),this.isAdmin&&await this.loadRecords(1)}catch(i){console.error("提交失败:",i),alert(i.message||"提交失败，请稍后重试")}finally{this.loading=!1}}},async deleteRecord(i){if(confirm("确定要删除这条记录吗？"))try{if(!(await fetch(`/records/${i}`,{method:"DELETE"})).ok)throw new Error("删除失败");await this.loadRecords()}catch(e){console.error("删除失败:",e),alert("删除失败，请稍后重试")}},async loginAdmin(){prompt("请输入管理员密码：")==="hy012210yxj"?(this.isAdmin=!0,await this.loadRecords()):alert("密码错误！")},logout(){this.isAdmin=!1,this.records=[],this.currentPage=1,this.totalPages=1},resetForm(){this.form={name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},this.errors={},this.generateVerificationCode()},formatRecord(i){return`姓名: ${i.name}
联系方式: ${i.contact}
身份证号: ${i.idNumber}
意向厂区: ${i.location}
提交时间: ${new Date(i.createdAt).toLocaleString()}`}}},A={class:"form-wrapper"},R={key:0,class:"error"},D={key:0,class:"error"},q={key:0,class:"error"},x={key:0,class:"error"},j=["disabled"],B={key:0,class:"submitted-info"},E={key:1,class:"admin-view"},F=["onClick"],T={class:"pagination"},M=["disabled"],U=["disabled"],O={key:2,class:"admin-login"};function z(i,e,s,f,t,n){return l(),a("div",A,[o("form",{onSubmit:e[10]||(e[10]=g((...r)=>n.handleSubmit&&n.handleSubmit(...r),["prevent"]))},[o("label",null,[e[15]||(e[15]=m(" 姓名 ")),c(o("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.form.name=r),placeholder:"请填写真实姓名",required:"","aria-required":"true","aria-label":"姓名",onBlur:e[1]||(e[1]=(...r)=>n.validateNameInput&&n.validateNameInput(...r))},null,544),[[h,t.form.name,void 0,{trim:!0}]]),t.errors.name?(l(),a("span",R,d(t.errors.name),1)):u("",!0)]),o("label",null,[e[16]||(e[16]=m(" 联系方式 ")),c(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.form.contact=r),placeholder:"请填写手机号",required:"",onBlur:e[3]||(e[3]=(...r)=>n.validatePhoneInput&&n.validatePhoneInput(...r)),"aria-required":"true","aria-label":"联系方式"},null,544),[[h,t.form.contact,void 0,{trim:!0}]]),t.errors.contact?(l(),a("span",D,d(t.errors.contact),1)):u("",!0)]),o("label",null,[e[17]||(e[17]=m(" 身份证号 ")),c(o("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.form.idNumber=r),placeholder:"请填写身份证号",required:"",onBlur:e[5]||(e[5]=(...r)=>n.validateIDInput&&n.validateIDInput(...r)),"aria-required":"true","aria-label":"身份证号"},null,544),[[h,t.form.idNumber,void 0,{trim:!0}]]),t.errors.idNumber?(l(),a("span",q,d(t.errors.idNumber),1)):u("",!0)]),o("label",null,[e[19]||(e[19]=m(" 意向厂区 ")),c(o("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>t.form.location=r),"aria-label":"意向厂区"},e[18]||(e[18]=[o("option",{value:"广东深圳"},"广东深圳",-1)]),512),[[C,t.form.location]])]),o("label",null,[e[20]||(e[20]=m(" 图形验证码 ")),c(o("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>t.form.verificationCode=r),placeholder:"请填写",required:"","aria-required":"true","aria-label":"验证码"},null,512),[[h,t.form.verificationCode]]),o("span",{class:"verification",onClick:e[8]||(e[8]=(...r)=>n.generateVerificationCode&&n.generateVerificationCode(...r)),role:"button",tabindex:"0",onKeydown:e[9]||(e[9]=P(g((...r)=>n.generateVerificationCode&&n.generateVerificationCode(...r),["prevent"]),["enter"]))},d(t.generatedVerificationCode),33),t.errors.verificationCode?(l(),a("span",x,d(t.errors.verificationCode),1)):u("",!0)]),o("button",{type:"submit",disabled:t.loading},d(t.loading?"提交中...":"提交"),9,j)],32),t.submitted?(l(),a("div",B,[e[21]||(e[21]=o("h3",null,"您提交的信息",-1)),o("pre",null,d(n.formatRecord(t.lastSubmittedForm)),1)])):u("",!0),t.isAdmin?(l(),a("div",E,[e[22]||(e[22]=o("h3",null,"所有填表记录",-1)),o("button",{onClick:e[11]||(e[11]=(...r)=>n.logout&&n.logout(...r))},"退出管理员"),(l(!0),a(y,null,w(t.records,r=>(l(),a("div",{key:r.id,class:"record"},[o("pre",null,d(n.formatRecord(r)),1),o("button",{onClick:p=>n.deleteRecord(r.id)},"删除",8,F)]))),128)),o("div",T,[o("button",{onClick:e[12]||(e[12]=r=>i.changePage(t.currentPage-1)),disabled:t.currentPage===1},"上一页",8,M),o("span",null,"第 "+d(t.currentPage)+" 页 / 共 "+d(t.totalPages)+" 页",1),o("button",{onClick:e[13]||(e[13]=r=>i.changePage(t.currentPage+1)),disabled:t.currentPage>=t.totalPages},"下一页",8,U)])])):u("",!0),t.isAdmin?u("",!0):(l(),a("div",O,[o("a",{href:"#",onClick:e[14]||(e[14]=g((...r)=>n.loginAdmin&&n.loginAdmin(...r),["prevent"])),"aria-label":"管理员登录"},"管理员入口")]))])}const L=v(S,[["render",z],["__scopeId","data-v-642ce030"]]),X=JSON.parse('{"title":"","description":"","frontmatter":{"page":true,"head":[["link",{"rel":"canonical","href":"https://b.14ll.com/biao"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"biao.md","filePath":"biao.md"}'),J={name:"biao.md"},G=Object.assign(J,{setup(i){return(e,s)=>(l(),a("div",null,[k(L)]))}});export{X as __pageData,G as default};
