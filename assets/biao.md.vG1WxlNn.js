import{_ as v,c as s,o as l,j as n,e as u,a as c,am as f,an as p,t as d,ao as C,Z as k,a0 as b,F as y,B as w,G as I}from"./chunks/framework.CvQVt9Yw.js";const h={debounce(r,e){let a;return function(...m){clearTimeout(a),a=setTimeout(()=>r.apply(this,m),e)}},generateRandomCode(r=4){const e="0123456789";return Array.from({length:r},()=>e[Math.floor(Math.random()*e.length)]).join("")},validatePhone(r){return/^1[3-9]\d{9}$/.test(r)},validateChineseID(r){if(!/^\d{17}[\dXx]$/.test(r))return!1;const a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],m=["1","0","X","9","8","7","6","5","4","3","2"],o=r.substring(0,17).split("").reduce((i,t,g)=>i+parseInt(t)*a[g],0);return m[o%11]===r[17].toUpperCase()}},V={data(){return{form:{name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},generatedVerificationCode:"",submitted:!1,lastSubmittedForm:{},records:[],isAdmin:!1,authToken:"",errors:{},loading:!1}},mounted(){this.generateVerificationCode();const r=localStorage.getItem("adminToken");r&&(this.authToken=r,this.isAdmin=!0,this.loadRecords())},methods:{generateVerificationCode(){this.generatedVerificationCode=h.generateRandomCode(),this.errors.verificationCode=""},validatePhoneInput:h.debounce(function(){this.form.contact&&!h.validatePhone(this.form.contact)?this.errors.contact="手机号格式不正确":this.errors.contact=""},300),validateIDInput:h.debounce(function(){this.form.idNumber&&!h.validateChineseID(this.form.idNumber)?this.errors.idNumber="身份证号格式不正确":this.errors.idNumber=""},300),validateNameInput(){this.form.name&&this.form.name.length<2?this.errors.name="姓名至少需要2个字符":this.errors.name=""},async loadRecords(){try{const r={};this.isAdmin&&(r.Authorization=this.authToken);const e=await fetch("/records",{headers:r});if(!e.ok){const m=await e.json();throw new Error(m.error||"加载失败")}const a=await e.json();this.records=Array.isArray(a)?a:a.records||[]}catch(r){console.error("加载记录失败:",r),alert("加载记录失败: "+r.message)}},async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const r=await fetch("/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(!r.ok){const a=await r.json();throw new Error(a.error||"提交失败")}const e=await r.json();this.lastSubmittedForm=e,this.submitted=!0,this.resetForm(),this.isAdmin&&await this.loadRecords()}catch(r){console.error("提交失败:",r),alert("提交失败: "+r.message)}finally{this.loading=!1}}},async deleteRecord(r){if(confirm("确定要删除这条记录吗？"))try{const e=await fetch(`/records/${r}`,{method:"DELETE",headers:{Authorization:this.authToken}});if(!e.ok){const a=await e.json();throw new Error(a.error||"删除失败")}await this.loadRecords(),alert("删除成功")}catch(e){console.error("删除失败:",e),alert("删除失败: "+e.message)}},async loginAdmin(){const r=prompt("请输入管理员密码：");r==="hy012210yxj"?(this.authToken=`Bearer ${r}`,localStorage.setItem("adminToken",this.authToken),this.isAdmin=!0,await this.loadRecords()):alert("密码错误！")},logout(){this.isAdmin=!1,this.authToken="",this.records=[],localStorage.removeItem("adminToken")},resetForm(){this.form={name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},this.errors={},this.generateVerificationCode()},formatRecord(r){return`姓名: ${r.name}
联系方式: ${r.contact}
身份证号: ${r.idNumber}
意向厂区: ${r.location}
提交时间: ${new Date(r.createdAt).toLocaleString()}`}}},N={class:"form-wrapper"},A={key:0,class:"error"},T={key:0,class:"error"},S={key:0,class:"error"},R={key:0,class:"error"},D=["disabled"],P={key:0,class:"submitted-info"},j={key:1,class:"admin-view"},x=["onClick"],q={key:2,class:"admin-login"};function B(r,e,a,m,o,i){return l(),s("div",N,[n("form",{onSubmit:e[10]||(e[10]=b((...t)=>i.handleSubmit&&i.handleSubmit(...t),["prevent"]))},[n("label",null,[e[13]||(e[13]=c(" 姓名 ")),f(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.name=t),placeholder:"请填写真实姓名",required:"","aria-required":"true","aria-label":"姓名",onBlur:e[1]||(e[1]=(...t)=>i.validateNameInput&&i.validateNameInput(...t))},null,544),[[p,o.form.name,void 0,{trim:!0}]]),o.errors.name?(l(),s("span",A,d(o.errors.name),1)):u("",!0)]),n("label",null,[e[14]||(e[14]=c(" 联系方式 ")),f(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.contact=t),placeholder:"请填写手机号",required:"",onBlur:e[3]||(e[3]=(...t)=>i.validatePhoneInput&&i.validatePhoneInput(...t)),"aria-required":"true","aria-label":"联系方式"},null,544),[[p,o.form.contact,void 0,{trim:!0}]]),o.errors.contact?(l(),s("span",T,d(o.errors.contact),1)):u("",!0)]),n("label",null,[e[15]||(e[15]=c(" 身份证号 ")),f(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.idNumber=t),placeholder:"请填写身份证号",required:"",onBlur:e[5]||(e[5]=(...t)=>i.validateIDInput&&i.validateIDInput(...t)),"aria-required":"true","aria-label":"身份证号"},null,544),[[p,o.form.idNumber,void 0,{trim:!0}]]),o.errors.idNumber?(l(),s("span",S,d(o.errors.idNumber),1)):u("",!0)]),n("label",null,[e[17]||(e[17]=c(" 意向厂区 ")),f(n("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.location=t),"aria-label":"意向厂区"},e[16]||(e[16]=[n("option",{value:"广东深圳"},"广东深圳",-1)]),512),[[C,o.form.location]])]),n("label",null,[e[18]||(e[18]=c(" 图形验证码 ")),f(n("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.verificationCode=t),placeholder:"请填写",required:"","aria-required":"true","aria-label":"验证码"},null,512),[[p,o.form.verificationCode]]),n("span",{class:"verification",onClick:e[8]||(e[8]=(...t)=>i.generateVerificationCode&&i.generateVerificationCode(...t)),role:"button",tabindex:"0",onKeydown:e[9]||(e[9]=k(b((...t)=>i.generateVerificationCode&&i.generateVerificationCode(...t),["prevent"]),["enter"]))},d(o.generatedVerificationCode),33),o.errors.verificationCode?(l(),s("span",R,d(o.errors.verificationCode),1)):u("",!0)]),n("button",{type:"submit",disabled:o.loading},d(o.loading?"提交中...":"提交"),9,D)],32),o.submitted?(l(),s("div",P,[e[19]||(e[19]=n("h3",null,"您提交的信息",-1)),n("pre",null,d(i.formatRecord(o.lastSubmittedForm)),1)])):u("",!0),o.isAdmin?(l(),s("div",j,[e[20]||(e[20]=n("h3",null,"所有填表记录",-1)),n("button",{onClick:e[11]||(e[11]=(...t)=>i.logout&&i.logout(...t))},"退出管理员"),(l(!0),s(y,null,w(o.records,t=>(l(),s("div",{key:t.id,class:"record"},[n("pre",null,d(i.formatRecord(t)),1),n("button",{onClick:g=>i.deleteRecord(t.id)},"删除",8,x)]))),128))])):u("",!0),o.isAdmin?u("",!0):(l(),s("div",q,[n("a",{href:"#",onClick:e[12]||(e[12]=b((...t)=>i.loginAdmin&&i.loginAdmin(...t),["prevent"])),"aria-label":"管理员登录"},"管理员入口")]))])}const E=v(V,[["render",B],["__scopeId","data-v-07a6cf1e"]]),U=JSON.parse('{"title":"","description":"","frontmatter":{"page":true,"head":[["link",{"rel":"canonical","href":"https://b.14ll.com/biao"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"biao.md","filePath":"biao.md"}'),F={name:"biao.md"},O=Object.assign(F,{setup(r){return(e,a)=>(l(),s("div",null,[I(E)]))}});export{U as __pageData,O as default};
