import{_ as g,c as s,o as a,j as n,e as u,a as m,am as f,an as h,t as d,ao as C,Z as y,a0 as p,F as w,B as V,G as k}from"./chunks/framework.CvQVt9Yw.js";function v(r,e){let l;return function(...c){clearTimeout(l),l=setTimeout(()=>r.apply(this,c),e)}}function I(r=4){const e="0123456789";return Array.from({length:r},()=>e[Math.floor(Math.random()*e.length)]).join("")}function N(r){return/^1[3-9]\d{9}$/.test(r)}function S(r){if(!/^\d{17}[\dXx]$/.test(r))return!1;const l=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],c=["1","0","X","9","8","7","6","5","4","3","2"],i=r.substring(0,17).split("").reduce((o,t,b)=>o+parseInt(t)*l[b],0);return c[i%11]===r[17].toUpperCase()}const A={data(){return{form:{name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},generatedVerificationCode:"",submitted:!1,lastSubmittedForm:{},records:[],isAdmin:!1,errors:{},loading:!1}},mounted(){this.generateVerificationCode(),this.isAdmin&&this.loadRecords()},methods:{generateVerificationCode(){this.generatedVerificationCode=I(),this.errors.verificationCode=""},validatePhoneInput:v(function(){this.form.contact&&!N(this.form.contact)?this.errors.contact="手机号格式不正确":this.errors.contact=""},300),validateIDInput:v(function(){this.form.idNumber&&!S(this.form.idNumber)?this.errors.idNumber="身份证号格式不正确":this.errors.idNumber=""},300),validateNameInput(){this.form.name&&this.form.name.length<2?this.errors.name="姓名至少需要2个字符":this.errors.name=""},async loadRecords(){try{const r=await fetch("/records");if(!r.ok)throw new Error("加载失败");const e=await r.json();this.records=e.records||[]}catch(r){console.error("加载记录失败:",r),alert("加载记录失败，请稍后重试")}},async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const r=await fetch("/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(!r.ok){const l=await r.text();throw new Error(l||"提交失败")}const e=await r.json();this.lastSubmittedForm=e,this.submitted=!0,this.resetForm(),this.isAdmin&&await this.loadRecords()}catch(r){console.error("提交失败:",r),alert(r.message||"提交失败，请稍后重试")}finally{this.loading=!1}}},async deleteRecord(r){if(confirm("确定要删除这条记录吗？"))try{if(!(await fetch(`/records/${r}`,{method:"DELETE"})).ok)throw new Error("删除失败");await this.loadRecords()}catch(e){console.error("删除失败:",e),alert("删除失败，请稍后重试")}},async loginAdmin(){prompt("请输入管理员密码：")==="hy012210yxj"?(this.isAdmin=!0,await this.loadRecords()):alert("密码错误！")},logout(){this.isAdmin=!1,this.records=[]},resetForm(){this.form={name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},this.errors={},this.generateVerificationCode()},formatRecord(r){return`姓名: ${r.name}
联系方式: ${r.contact}
身份证号: ${r.idNumber}
意向厂区: ${r.location}
提交时间: ${new Date(r.createdAt).toLocaleString()}`}}},R={class:"form-wrapper"},x={key:0,class:"error"},D={key:0,class:"error"},P={key:0,class:"error"},q={key:0,class:"error"},j=["disabled"],B={key:0,class:"submitted-info"},E={key:1,class:"admin-view"},F=["onClick"],T={key:2,class:"admin-login"};function M(r,e,l,c,i,o){return a(),s("div",R,[n("form",{onSubmit:e[10]||(e[10]=p((...t)=>o.handleSubmit&&o.handleSubmit(...t),["prevent"]))},[n("label",null,[e[13]||(e[13]=m(" 姓名 ")),f(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.form.name=t),placeholder:"请填写真实姓名",required:"","aria-required":"true","aria-label":"姓名",onBlur:e[1]||(e[1]=(...t)=>o.validateNameInput&&o.validateNameInput(...t))},null,544),[[h,i.form.name,void 0,{trim:!0}]]),i.errors.name?(a(),s("span",x,d(i.errors.name),1)):u("",!0)]),n("label",null,[e[14]||(e[14]=m(" 联系方式 ")),f(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>i.form.contact=t),placeholder:"请填写手机号",required:"",onBlur:e[3]||(e[3]=(...t)=>o.validatePhoneInput&&o.validatePhoneInput(...t)),"aria-required":"true","aria-label":"联系方式"},null,544),[[h,i.form.contact,void 0,{trim:!0}]]),i.errors.contact?(a(),s("span",D,d(i.errors.contact),1)):u("",!0)]),n("label",null,[e[15]||(e[15]=m(" 身份证号 ")),f(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.form.idNumber=t),placeholder:"请填写身份证号",required:"",onBlur:e[5]||(e[5]=(...t)=>o.validateIDInput&&o.validateIDInput(...t)),"aria-required":"true","aria-label":"身份证号"},null,544),[[h,i.form.idNumber,void 0,{trim:!0}]]),i.errors.idNumber?(a(),s("span",P,d(i.errors.idNumber),1)):u("",!0)]),n("label",null,[e[17]||(e[17]=m(" 意向厂区 ")),f(n("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i.form.location=t),"aria-label":"意向厂区"},e[16]||(e[16]=[n("option",{value:"广东深圳"},"广东深圳",-1)]),512),[[C,i.form.location]])]),n("label",null,[e[18]||(e[18]=m(" 图形验证码 ")),f(n("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>i.form.verificationCode=t),placeholder:"请填写",required:"","aria-required":"true","aria-label":"验证码"},null,512),[[h,i.form.verificationCode]]),n("span",{class:"verification",onClick:e[8]||(e[8]=(...t)=>o.generateVerificationCode&&o.generateVerificationCode(...t)),role:"button",tabindex:"0",onKeydown:e[9]||(e[9]=y(p((...t)=>o.generateVerificationCode&&o.generateVerificationCode(...t),["prevent"]),["enter"]))},d(i.generatedVerificationCode),33),i.errors.verificationCode?(a(),s("span",q,d(i.errors.verificationCode),1)):u("",!0)]),n("button",{type:"submit",disabled:i.loading},d(i.loading?"提交中...":"提交"),9,j)],32),i.submitted?(a(),s("div",B,[e[19]||(e[19]=n("h3",null,"您提交的信息",-1)),n("pre",null,d(o.formatRecord(i.lastSubmittedForm)),1)])):u("",!0),i.isAdmin?(a(),s("div",E,[e[20]||(e[20]=n("h3",null,"所有填表记录",-1)),n("button",{onClick:e[11]||(e[11]=(...t)=>o.logout&&o.logout(...t))},"退出管理员"),(a(!0),s(w,null,V(i.records,t=>(a(),s("div",{key:t.id,class:"record"},[n("pre",null,d(o.formatRecord(t)),1),n("button",{onClick:b=>o.deleteRecord(t.id)},"删除",8,F)]))),128))])):u("",!0),i.isAdmin?u("",!0):(a(),s("div",T,[n("a",{href:"#",onClick:e[12]||(e[12]=p((...t)=>o.loginAdmin&&o.loginAdmin(...t),["prevent"])),"aria-label":"管理员登录"},"管理员入口")]))])}const U=g(A,[["render",M],["__scopeId","data-v-4089056c"]]),J=JSON.parse('{"title":"","description":"","frontmatter":{"page":true,"head":[["link",{"rel":"canonical","href":"https://b.14ll.com/biao"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"biao.md","filePath":"biao.md"}'),O={name:"biao.md"},K=Object.assign(O,{setup(r){return(e,l)=>(a(),s("div",null,[k(U)]))}});export{J as __pageData,K as default};
