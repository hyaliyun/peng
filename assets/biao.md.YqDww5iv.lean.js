import{_ as v,c as a,o as l,j as o,e as u,a as m,am as f,an as h,t as d,ao as y,Z as C,a0 as g,F as w,B as P,G as k}from"./chunks/framework.CvQVt9Yw.js";function b(t,e){let s;return function(...c){clearTimeout(s),s=setTimeout(()=>t.apply(this,c),e)}}function I(t=4){const e="0123456789";return Array.from({length:t},()=>e[Math.floor(Math.random()*e.length)]).join("")}function N(t){return/^1[3-9]\d{9}$/.test(t)}function V(t){if(!/^\d{17}[\dXx]$/.test(t))return!1;const s=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],c=["1","0","X","9","8","7","6","5","4","3","2"],r=t.substring(0,17).split("").reduce((n,i,p)=>n+parseInt(i)*s[p],0);return c[r%11]===t[17].toUpperCase()}const R={data(){return{form:{name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},generatedVerificationCode:"",submitted:!1,lastSubmittedForm:{},records:[],isAdmin:!1,currentPage:1,totalPages:1,pageSize:5,errors:{},loading:!1}},methods:{async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const t=await fetch("/api/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(!t.ok)throw new Error("提交失败");const e=await t.json();this.lastSubmittedForm=e,this.submitted=!0,this.resetForm()}catch(t){alert(t.message)}finally{this.loading=!1}}},async loginAdmin(){if(prompt("请输入管理员密码：")==="hy012210yxj")try{const e=await fetch("/api/records");if(!e.ok)throw new Error("获取记录失败");this.allRecords=await e.json(),this.isAdmin=!0}catch(e){alert(e.message)}else alert("密码错误，请重试！")},async deleteRecord(t){const e=this.paginatedRecords[t];if(e!=null&&e.id)try{if(!(await fetch(`/api/records/${e.id}`,{method:"DELETE"})).ok)throw new Error("删除失败");this.allRecords=this.allRecords.filter(c=>c.id!==e.id),this.paginatedRecords.length===0&&this.currentPage>1&&this.currentPage--}catch(s){alert(s.message)}}},mounted(){this.generateVerificationCode(),this.loadRecords()},methods:{generateVerificationCode(){this.generatedVerificationCode=I(),this.errors.verificationCode=""},validatePhoneInput:b(function(){this.form.contact&&!N(this.form.contact)?this.errors.contact="手机号格式不正确":this.errors.contact=""},300),validateIDInput:b(function(){this.form.idNumber&&!V(this.form.idNumber)?this.errors.idNumber="身份证号格式不正确":this.errors.idNumber=""},300),validateNameInput(){this.form.name&&this.form.name.length<2?this.errors.name="姓名至少需要2个字符":this.errors.name=""},async loadRecords(t=this.currentPage){try{const e=await fetch(`/records?page=${t}&pageSize=${this.pageSize}`);if(!e.ok)throw new Error("加载失败");const s=await e.json();this.records=s.records,this.currentPage=s.currentPage,this.totalPages=s.totalPages}catch(e){console.error("加载记录失败",e)}},async handleSubmit(){if(this.validateNameInput(),this.validatePhoneInput(),this.validateIDInput(),this.form.verificationCode!==this.generatedVerificationCode){this.errors.verificationCode="验证码错误",this.generateVerificationCode();return}if(!(this.errors.name||this.errors.contact||this.errors.idNumber)){this.loading=!0;try{const t=await fetch("/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(!t.ok)throw new Error("提交失败");const e=await t.json();this.lastSubmittedForm=e,this.submitted=!0,await this.loadRecords(1)}catch(t){console.error(t),alert("提交失败，请稍后重试")}finally{this.loading=!1,this.resetForm()}}},resetForm(){this.form={name:"",contact:"",idNumber:"",location:"广东深圳",verificationCode:"",agree:!0},this.errors={},this.generateVerificationCode()},formatRecord(t){return`姓名: ${t.name}
联系方式: ${t.contact}
身份证号: ${t.idNumber}
意向厂区: ${t.location}
推荐承诺书: ${t.agree?"已同意":"未同意"}`},async deleteRecord(t){if(confirm("确定要删除这条记录吗？"))try{if(!(await fetch(`/records/${t}`,{method:"DELETE"})).ok)throw new Error("删除失败");await this.loadRecords()}catch(e){console.error(e),alert("删除失败，请稍后重试")}},async loginAdmin(){prompt("请输入管理员密码：")==="hy012210yxj"?(this.isAdmin=!0,await this.loadRecords()):alert("密码错误，请重试！")},logout(){this.isAdmin=!1,this.records=[],this.currentPage=1,this.totalPages=1},changePage(t){t<1||t>this.totalPages||this.loadRecords(t)}}},S={class:"form-wrapper"},E={key:0,class:"error"},j={key:0,class:"error"},A={key:0,class:"error"},D={key:0,class:"error"},x=["disabled"],T={key:0,class:"submitted-info"},F={key:1,class:"admin-view"},q=["onClick"],B={class:"pagination"},M=["disabled"],O=["disabled"],U={key:2,class:"admin-login"};function z(t,e,s,c,r,n){return l(),a("div",S,[o("form",{onSubmit:e[10]||(e[10]=g((...i)=>n.handleSubmit&&n.handleSubmit(...i),["prevent"]))},[o("label",null,[e[15]||(e[15]=m(" 姓名 ")),f(o("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>r.form.name=i),placeholder:"请填写真实姓名",required:"","aria-required":"true","aria-label":"姓名",onBlur:e[1]||(e[1]=(...i)=>n.validateNameInput&&n.validateNameInput(...i))},null,544),[[h,r.form.name,void 0,{trim:!0}]]),r.errors.name?(l(),a("span",E,d(r.errors.name),1)):u("",!0)]),o("label",null,[e[16]||(e[16]=m(" 联系方式 ")),f(o("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>r.form.contact=i),placeholder:"请填写手机号",required:"",onBlur:e[3]||(e[3]=(...i)=>n.validatePhoneInput&&n.validatePhoneInput(...i)),"aria-required":"true","aria-label":"联系方式"},null,544),[[h,r.form.contact,void 0,{trim:!0}]]),r.errors.contact?(l(),a("span",j,d(r.errors.contact),1)):u("",!0)]),o("label",null,[e[17]||(e[17]=m(" 身份证号 ")),f(o("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>r.form.idNumber=i),placeholder:"请填写身份证号",required:"",onBlur:e[5]||(e[5]=(...i)=>n.validateIDInput&&n.validateIDInput(...i)),"aria-required":"true","aria-label":"身份证号"},null,544),[[h,r.form.idNumber,void 0,{trim:!0}]]),r.errors.idNumber?(l(),a("span",A,d(r.errors.idNumber),1)):u("",!0)]),o("label",null,[e[19]||(e[19]=m(" 意向厂区 ")),f(o("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.form.location=i),"aria-label":"意向厂区"},e[18]||(e[18]=[o("option",{value:"广东深圳"},"广东深圳",-1)]),512),[[y,r.form.location]])]),o("label",null,[e[20]||(e[20]=m(" 图形验证码 ")),f(o("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.form.verificationCode=i),placeholder:"请填写",required:"","aria-required":"true","aria-label":"验证码"},null,512),[[h,r.form.verificationCode]]),o("span",{class:"verification",onClick:e[8]||(e[8]=(...i)=>n.generateVerificationCode&&n.generateVerificationCode(...i)),role:"button",tabindex:"0",onKeydown:e[9]||(e[9]=C(g((...i)=>n.generateVerificationCode&&n.generateVerificationCode(...i),["prevent"]),["enter"]))},d(r.generatedVerificationCode),33),r.errors.verificationCode?(l(),a("span",D,d(r.errors.verificationCode),1)):u("",!0)]),o("button",{type:"submit",disabled:r.loading},d(r.loading?"提交中...":"提交"),9,x)],32),r.submitted?(l(),a("div",T,[e[21]||(e[21]=o("h3",null,"您提交的信息",-1)),o("pre",null,d(n.formatRecord(r.lastSubmittedForm)),1)])):u("",!0),r.isAdmin?(l(),a("div",F,[e[22]||(e[22]=o("h3",null,"所有填表记录",-1)),o("button",{onClick:e[11]||(e[11]=(...i)=>n.logout&&n.logout(...i))},"退出管理员"),(l(!0),a(w,null,P(r.records,i=>(l(),a("div",{key:i.id,class:"record"},[o("pre",null,d(n.formatRecord(i)),1),o("button",{onClick:p=>n.deleteRecord(i.id)},"删除",8,q)]))),128)),o("div",B,[o("button",{onClick:e[12]||(e[12]=i=>n.changePage(r.currentPage-1)),disabled:r.currentPage===1},"上一页",8,M),o("span",null,"第 "+d(r.currentPage)+" 页 / 共 "+d(r.totalPages)+" 页",1),o("button",{onClick:e[13]||(e[13]=i=>n.changePage(r.currentPage+1)),disabled:r.currentPage>=r.totalPages},"下一页",8,O)])])):u("",!0),r.isAdmin?u("",!0):(l(),a("div",U,[o("a",{href:"#",onClick:e[14]||(e[14]=g((...i)=>n.loginAdmin&&n.loginAdmin(...i),["prevent"])),"aria-label":"管理员登录"},"管理员入口")]))])}const J=v(R,[["render",z],["__scopeId","data-v-62efdded"]]),K=JSON.parse('{"title":"","description":"","frontmatter":{"page":true,"head":[["link",{"rel":"canonical","href":"https://b.14ll.com/biao"}],["meta",{"property":"og:title","content":""}]]},"headers":[],"relativePath":"biao.md","filePath":"biao.md"}'),L={name:"biao.md"},X=Object.assign(L,{setup(t){return(e,s)=>(l(),a("div",null,[k(J)]))}});export{K as __pageData,X as default};
